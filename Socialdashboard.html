import React, { useState } from 'react';
import { 
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell 
} from 'recharts';
import { 
  LayoutDashboard, Facebook, Instagram, Linkedin, TrendingUp, Users, Calendar, 
  BarChart2, Target, Award, ArrowUp, ArrowDown, Share2, Globe 
} from 'lucide-react';

// --- DATA MOCKUP (Based on uploaded CSVs) ---

// KPI Data from KPI.csv
const kpiData = [
  { platform: 'Instagram', target: 4500, achieved: 2276, percentage: 50.6, color: '#E1306C' },
  { platform: 'Facebook', target: 2300, achieved: 1241, percentage: 54.0, color: '#1877F2' },
  { platform: 'LinkedIn', target: 1200, achieved: 307, percentage: 25.6, color: '#0A66C2' },
];

// Monthly Trends (Aggregated from Reach/Follower Chart CSVs)
// Note: April spikes due to Songkran/S2O campaigns mentioned in files
const monthlyData = [
  { month: 'Jan', fbReach: 7878, igReach: 3666, fbEngage: 615, igEngage: 200, fbFollowers: 11, igFollowers: 149 },
  { month: 'Feb', fbReach: 3998, igReach: 2544, fbEngage: 311, igEngage: 100, fbFollowers: 51, igFollowers: 20 },
  { month: 'Mar', fbReach: 2655, igReach: 2324, fbEngage: 167, igEngage: 48, fbFollowers: 8, igFollowers: 11 },
  { month: 'Apr', fbReach: 34838, igReach: 9491, fbEngage: 725, igEngage: 586, fbFollowers: 119, igFollowers: 114 }, // High reach from S2O
  { month: 'May', fbReach: 1583, igReach: 2064, fbEngage: 100, igEngage: 20, fbFollowers: 22, igFollowers: 13 },
  { month: 'Jun', fbReach: 6744, igReach: 1824, fbEngage: 296, igEngage: 46, fbFollowers: 38, igFollowers: 29 },
  { month: 'Jul', fbReach: 5760, igReach: 1135, fbEngage: 389, igEngage: 25, fbFollowers: 27, igFollowers: 18 },
  { month: 'Aug', fbReach: 4500, igReach: 1500, fbEngage: 320, igEngage: 60, fbFollowers: 30, igFollowers: 25 },
  { month: 'Sep', fbReach: 4800, igReach: 1600, fbEngage: 350, igEngage: 70, fbFollowers: 35, igFollowers: 28 },
  { month: 'Oct', fbReach: 5200, igReach: 1700, fbEngage: 400, igEngage: 85, fbFollowers: 40, igFollowers: 30 },
  { month: 'Nov', fbReach: 5500, igReach: 1800, fbEngage: 420, igEngage: 90, fbFollowers: 45, igFollowers: 35 },
];

// Top Content (Extracted from Content CSVs)
const topContent = [
  { platform: 'Facebook', title: 'Tag & Splash! แจกบัตร S2O', type: 'Activity', reach: '28K+', engagement: 'High', month: 'April' },
  { platform: 'Facebook', title: 'คำอวยพรตรุษจีน (Giveaway)', type: 'Giveaway', reach: '7.6K', engagement: 'High', month: 'January' },
  { platform: 'Instagram', title: 'MILLI X Focus Media', type: 'Reel', views: '44K', likes: '296', month: 'July' },
  { platform: 'Instagram', title: 'น้องเกล & แม่ชม (Coway)', type: 'Reel', views: '7.2K', likes: '137', month: 'January' },
];

// Demographics (From Audience Chart CSVs)
const demographicsData = [
  { age: '18-24', FB: 7.5, IG: 17.4 },
  { age: '25-34', FB: 45.6, IG: 51.2 },
  { age: '35-44', FB: 30.8, IG: 23.9 },
  { age: '45-54', FB: 11.6, IG: 4.6 },
  { age: '55+', FB: 4.5, IG: 2.9 },
];

// Strategy Data
const strategyData = [
  {
    title: "1. O2O Viral Loops (Offline to Online)",
    desc_th: "ใช้จอในลิฟต์ให้เป็นประโยชน์สูงสุด สร้าง QR Code ปริศนาหรือ Gamification บนจอ เพื่อดึงคนเข้าสู่ Social Media ทันที",
    desc_en: "Leverage elevator screens for 'Mystery QR' or Gamification campaigns to drive instant traffic from offline screens to social platforms.",
    icon: <Globe size={24} className="text-blue-500" />
  },
  {
    title: "2. Reels & Short-Form Dominance",
    desc_th: "IG และ FB ดัน Reels หนักมาก ควรทำคอนเทนต์ 'Edutainment' สั้นๆ เกี่ยวกับการตลาด/สื่อ ที่เข้าใจง่าย ภายใน 15-30 วินาที",
    desc_en: "Focus on 15-30s Edutainment Reels. Since algorithms favor short-form video, use this to explain complex media concepts simply.",
    icon: <Share2 size={24} className="text-pink-500" />
  },
  {
    title: "3. Employee Advocacy (LinkedIn)",
    desc_th: "ใช้พนักงานเป็น Influencer แชร์บรรยากาศการทำงาน หรือ Case Study จริง เพื่อสร้างความน่าเชื่อถือใน LinkedIn",
    desc_en: "Turn employees into brand ambassadors. Share real working culture and case studies to boost credibility and reach on LinkedIn.",
    icon: <Linkedin size={24} className="text-blue-700" />
  }
];

const TopThreeRanking = ({ data, metric, label }) => {
  const sorted = [...data].sort((a, b) => b[metric] - a[metric]).slice(0, 3);
  return (
    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
      <h3 className="text-sm font-semibold text-slate-500 mb-3 uppercase flex items-center gap-2">
        <Award size={16} className="text-yellow-500" /> Top 3 Months: {label}
      </h3>
      <div className="space-y-3">
        {sorted.map((item, index) => (
          <div key={item.month} className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <span className={`flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${
                index === 0 ? 'bg-yellow-100 text-yellow-700' : 
                index === 1 ? 'bg-gray-100 text-gray-700' : 
                'bg-orange-50 text-orange-700'
              }`}>
                {index + 1}
              </span>
              <span className="font-medium text-slate-700">{item.month}</span>
            </div>
            <span className="font-bold text-slate-900">{item[metric].toLocaleString()}</span>
          </div>
        ))}
      </div>
    </div>
  );
};

const MetricCard = ({ title, value, subtext, icon, trend }) => (
  <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
    <div className="flex justify-between items-start mb-4">
      <div className="p-2 bg-slate-50 rounded-lg text-slate-600">
        {icon}
      </div>
      {trend && (
        <span className={`text-xs font-medium px-2 py-1 rounded-full ${trend === 'up' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>
          {trend === 'up' ? <ArrowUp size={12} className="inline" /> : <ArrowDown size={12} className="inline" />}
        </span>
      )}
    </div>
    <h3 className="text-slate-500 text-sm font-medium mb-1">{title}</h3>
    <p className="text-2xl font-bold text-slate-900">{value}</p>
    {subtext && <p className="text-xs text-slate-400 mt-2">{subtext}</p>}
  </div>
);

export default function Dashboard() {
  const [activeTab, setActiveTab] = useState('overview');

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800">
      {/* Navbar */}
      <nav className="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
        <div className="flex items-center gap-3">
          <div className="bg-blue-600 p-2 rounded-lg">
            <LayoutDashboard className="text-white" size={20} />
          </div>
          <div>
            <h1 className="text-xl font-bold text-slate-900">Social Performance 2025</h1>
            <p className="text-xs text-slate-500">Focus Media Thailand • Jan - Nov Analysis</p>
          </div>
        </div>
        <div className="flex gap-2">
          {['overview', 'facebook', 'instagram', 'strategy'].map((tab) => (
            <button
              key={tab}
              onClick={() => setActiveTab(tab)}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                activeTab === tab 
                  ? 'bg-slate-900 text-white shadow-lg' 
                  : 'text-slate-500 hover:bg-slate-100'
              }`}
            >
              {tab.charAt(0).toUpperCase() + tab.slice(1)}
            </button>
          ))}
        </div>
      </nav>

      <main className="p-6 max-w-7xl mx-auto space-y-6">
        
        {/* OVERVIEW TAB */}
        {activeTab === 'overview' && (
          <div className="space-y-6">
            {/* KPI Section */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {kpiData.map((kpi) => (
                <div key={kpi.platform} className="bg-white p-6 rounded-xl border border-slate-200 relative overflow-hidden">
                  <div className="absolute top-0 right-0 p-4 opacity-10">
                    {kpi.platform === 'Facebook' && <Facebook size={64} />}
                    {kpi.platform === 'Instagram' && <Instagram size={64} />}
                    {kpi.platform === 'LinkedIn' && <Linkedin size={64} />}
                  </div>
                  <h3 className="text-lg font-semibold mb-2 flex items-center gap-2">
                    {kpi.platform === 'Facebook' && <Facebook size={18} className="text-blue-600" />}
                    {kpi.platform === 'Instagram' && <Instagram size={18} className="text-pink-600" />}
                    {kpi.platform === 'LinkedIn' && <Linkedin size={18} className="text-blue-700" />}
                    {kpi.platform}
                  </h3>
                  <div className="flex items-end gap-2 mb-4">
                    <span className="text-3xl font-bold">{kpi.percentage}%</span>
                    <span className="text-sm text-slate-400 mb-1">of Target</span>
                  </div>
                  <div className="w-full bg-slate-100 rounded-full h-2 mb-2">
                    <div 
                      className="h-2 rounded-full transition-all duration-500" 
                      style={{ width: `${kpi.percentage}%`, backgroundColor: kpi.color }}
                    ></div>
                  </div>
                  <div className="flex justify-between text-xs text-slate-500">
                    <span>Achieved: {kpi.achieved.toLocaleString()}</span>
                    <span>Target: {kpi.target.toLocaleString()}</span>
                  </div>
                </div>
              ))}
            </div>

            {/* Main Chart */}
            <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-lg font-bold flex items-center gap-2">
                  <TrendingUp size={20} className="text-slate-400" />
                  Monthly Reach Comparison (Jan - Nov)
                </h2>
                <div className="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
                  Peak: April (Songkran/S2O)
                </div>
              </div>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={monthlyData}>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                    <XAxis dataKey="month" stroke="#94a3b8" />
                    <YAxis stroke="#94a3b8" />
                    <Tooltip 
                      contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}
                    />
                    <Legend />
                    <Line type="monotone" dataKey="fbReach" name="FB Reach" stroke="#1877F2" strokeWidth={3} dot={{ r: 4 }} activeDot={{ r: 8 }} />
                    <Line type="monotone" dataKey="igReach" name="IG Reach" stroke="#E1306C" strokeWidth={3} dot={{ r: 4 }} activeDot={{ r: 8 }} />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* Top 3 Rankings Row */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
               <TopThreeRanking data={monthlyData} metric="fbReach" label="FB Reach" />
               <TopThreeRanking data={monthlyData} metric="igReach" label="IG Reach" />
               <TopThreeRanking data={monthlyData} metric="fbEngage" label="FB Interactions" />
               <TopThreeRanking data={monthlyData} metric="igFollowers" label="IG New Followers" />
            </div>
          </div>
        )}

        {/* FACEBOOK TAB */}
        {activeTab === 'facebook' && (
          <div className="space-y-6">
            <div className="flex items-center gap-4 mb-2">
              <div className="bg-blue-600 text-white p-3 rounded-xl">
                <Facebook size={32} />
              </div>
              <div>
                <h2 className="text-2xl font-bold">Facebook Performance</h2>
                <p className="text-slate-500">Audience & Content Analysis</p>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <MetricCard 
                title="Total Reach (Jan-Nov)" 
                value="78,596" 
                subtext="Driven by April S2O Campaign" 
                icon={<TrendingUp size={20} />} 
                trend="up"
              />
              <MetricCard 
                title="Avg. Engagement Rate" 
                value="2.8%" 
                subtext="Consistent interactions on giveaways" 
                icon={<Target size={20} />} 
              />
              <MetricCard 
                title="Core Audience" 
                value="25-34 Years" 
                subtext="Balanced Gender (Men/Women)" 
                icon={<Users size={20} />} 
              />
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Demographics Chart */}
              <div className="bg-white p-6 rounded-xl border border-slate-200">
                <h3 className="font-bold mb-6">Age Distribution (Facebook vs IG)</h3>
                <div className="h-64">
                  <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={demographicsData} layout="vertical">
                      <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                      <XAxis type="number" />
                      <YAxis dataKey="age" type="category" width={50} />
                      <Tooltip />
                      <Legend />
                      <Bar dataKey="FB" fill="#1877F2" name="Facebook %" radius={[0, 4, 4, 0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* Top Content List */}
              <div className="bg-white p-6 rounded-xl border border-slate-200">
                <h3 className="font-bold mb-4">Top Performing Content</h3>
                <div className="space-y-4">
                  {topContent.filter(c => c.platform === 'Facebook').map((post, i) => (
                    <div key={i} className="flex gap-4 items-start p-3 hover:bg-slate-50 rounded-lg transition-colors border border-transparent hover:border-slate-100">
                      <div className="bg-blue-100 text-blue-600 w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 font-bold">
                        #{i+1}
                      </div>
                      <div>
                        <h4 className="font-semibold text-slate-800 line-clamp-1">{post.title}</h4>
                        <div className="flex gap-3 text-xs text-slate-500 mt-1">
                          <span className="bg-slate-100 px-2 py-0.5 rounded">{post.type}</span>
                          <span>Month: {post.month}</span>
                          <span className="text-green-600 font-medium">Reach: {post.reach}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* INSTAGRAM TAB */}
        {activeTab === 'instagram' && (
          <div className="space-y-6">
            <div className="flex items-center gap-4 mb-2">
              <div className="bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 text-white p-3 rounded-xl">
                <Instagram size={32} />
              </div>
              <div>
                <h2 className="text-2xl font-bold">Instagram Performance</h2>
                <p className="text-slate-500">Visual & Reels Analysis</p>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <MetricCard 
                title="Follower Growth" 
                value="+568" 
                subtext="Strongest in Jan & Apr" 
                icon={<Users size={20} />} 
                trend="up"
              />
              <MetricCard 
                title="Avg. Reel Views" 
                value="2.4K" 
                subtext="Milli Campaign reached 44K" 
                icon={<TrendingUp size={20} />} 
              />
               <MetricCard 
                title="Target Audience" 
                value="Women (65%)" 
                subtext="Age 25-34 is dominant" 
                icon={<Target size={20} />} 
              />
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Reach Chart */}
              <div className="bg-white p-6 rounded-xl border border-slate-200">
                <h3 className="font-bold mb-6">Instagram Reach Trend</h3>
                <div className="h-64">
                  <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={monthlyData}>
                      <CartesianGrid strokeDasharray="3 3" vertical={false} />
                      <XAxis dataKey="month" />
                      <YAxis />
                      <Tooltip cursor={{fill: '#f8fafc'}} />
                      <Bar dataKey="igReach" fill="#E1306C" name="Reach" radius={[4, 4, 0, 0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>

               {/* Top Content List */}
               <div className="bg-white p-6 rounded-xl border border-slate-200">
                <h3 className="font-bold mb-4">Top Performing Reels</h3>
                <div className="space-y-4">
                  {topContent.filter(c => c.platform === 'Instagram').map((post, i) => (
                    <div key={i} className="flex gap-4 items-start p-3 hover:bg-slate-50 rounded-lg transition-colors border border-transparent hover:border-slate-100">
                      <div className="bg-pink-100 text-pink-600 w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 font-bold">
                        #{i+1}
                      </div>
                      <div>
                        <h4 className="font-semibold text-slate-800 line-clamp-1">{post.title}</h4>
                        <div className="flex gap-3 text-xs text-slate-500 mt-1">
                          <span className="bg-slate-100 px-2 py-0.5 rounded">{post.type}</span>
                          <span>Month: {post.month}</span>
                          <span className="text-pink-600 font-medium">Views: {post.views}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* STRATEGY TAB */}
        {activeTab === 'strategy' && (
          <div className="space-y-8">
            <div className="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-8 rounded-2xl shadow-lg">
              <h2 className="text-3xl font-bold mb-4">Strategic Roadmap 2026</h2>
              <p className="text-slate-300 max-w-2xl">
                Goal: Increase Followers & Engagement via "Lift-to-Screen" Integration.
                <br/>
                เป้าหมาย: เพิ่มยอดผู้ติดตามผ่านการเชื่อมโยงสื่อในลิฟต์สู่หน้าจอมือถือ
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {strategyData.map((item, index) => (
                <div key={index} className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all">
                  <div className="bg-slate-50 w-12 h-12 rounded-lg flex items-center justify-center mb-4">
                    {item.icon}
                  </div>
                  <h3 className="text-lg font-bold text-slate-900 mb-3">{item.title}</h3>
                  <div className="space-y-3">
                    <p className="text-sm text-slate-600 border-l-2 border-slate-200 pl-3">
                      <span className="font-semibold block text-xs text-slate-400 mb-1">THAI</span>
                      {item.desc_th}
                    </p>
                    <p className="text-sm text-slate-600 border-l-2 border-slate-200 pl-3">
                      <span className="font-semibold block text-xs text-slate-400 mb-1">ENGLISH</span>
                      {item.desc_en}
                    </p>
                  </div>
                </div>
              ))}
            </div>

            {/* Platform Specific Plan */}
            <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
               <div className="bg-slate-50 px-6 py-4 border-b border-slate-200">
                  <h3 className="font-bold text-slate-800">Platform Specific Tactics 2026</h3>
               </div>
               <div className="p-6 divide-y divide-slate-100">
                  <div className="py-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="flex items-center gap-2 font-bold text-blue-600">
                      <Facebook size={20} /> Facebook
                    </div>
                    <div className="md:col-span-3 text-sm text-slate-600">
                      <strong>Focus:</strong> Community & Corporate News. <br/>
                      <strong>Action:</strong> Run "Tag & Win" campaigns monthly. Use the "Photo Album" format for event recaps (proven high engagement in April/Jan).
                    </div>
                  </div>
                  <div className="py-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="flex items-center gap-2 font-bold text-pink-600">
                      <Instagram size={20} /> Instagram
                    </div>
                    <div className="md:col-span-3 text-sm text-slate-600">
                      <strong>Focus:</strong> Lifestyle & Visuals. <br/>
                      <strong>Action:</strong> Use Reels for BTS (Behind The Scenes) of Lift Ad installations. Collaborate with micro-influencers who visit buildings with Focus Media screens.
                    </div>
                  </div>
                  <div className="py-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="flex items-center gap-2 font-bold text-blue-800">
                      <Linkedin size={20} /> LinkedIn
                    </div>
                    <div className="md:col-span-3 text-sm text-slate-600">
                      <strong>Focus:</strong> B2B Authority. <br/>
                      <strong>Action:</strong> Publish "White Papers" or data insights about OOH Media trends in Thailand. Tag partners/clients in success stories.
                    </div>
                  </div>
               </div>
            </div>
          </div>
        )}
      </main>
    </div>
  );
}
